<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Test Modale A4</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #eee;
      font-family: Arial, sans-serif;
      overflow-x: hidden;
    }

    .a4-page {
      width: 210mm;
      height: 297mm;
      margin-left: auto;
      margin-right: auto;
      padding: 20mm;
      background: white;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      page-break-after: always;
      display: block;
    }

    .a4-page * {
      max-width: 100%;
      box-sizing: border-box;
    }

    #signatureCanvas {
      border: 1px solid #ccc;
      background: #fff;
      width: 500px;
      height: 200px;
      display: block;
      margin: 12px auto;
    }

    #descriptif {
      display: block;
      width: 100%;
      margin-top: 6px;
      font-size: 11pt;
      line-height: 1.4;
      white-space: pre-wrap;
      word-wrap: break-word;
      resize: none;
      overflow-wrap: break-word;
    }

    .no-print {
      text-align: center;
      margin-top: 20px;
    }

    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 6px;
      text-align: center;
    }

    #modalCanvas {
      border: 2px solid #444;
      background: #fff;
      width: 500px;
      height: 200px;
      display: block;
      margin: 12px auto;
    }

    @media print {
      .no-print,
      .modal,
      .modal-content,
      #modalCanvas,
      #signatureModal {
        display: none !important;
      }

      #signatureCanvas {
        border: none !important;
      }

      .a4-page {
        box-shadow: none;
        margin: 0;
        padding: 20mm;
      }
    }
  </style>
</head>
<body>

  <!-- Page 1 -->
  <div class="a4-page">
    <h2>Page 1</h2>
    <p>Signature du client :</p>
    <canvas id="signatureCanvas"></canvas>
    <button onclick="openSignatureModal()">‚úçÔ∏è Signer</button>
  </div>

  <!-- Page 2 -->
  <div class="a4-page">
    <h2>Page 2</h2>
    <p><strong>Descriptif :</strong></p>
    <div id="descriptif" contenteditable="true">Zone de texte libre</div>

    <div class="no-print">
      <button onclick="exporterPDF()">üìÑ Exporter en PDF</button>
      <button onclick="sauvegarderDonnees()">üíæ Sauvegarder</button>
      <button onclick="restaurerDonnees()">üîÑ Restaurer</button>
      <button onclick="viderDonnees()">üßπ Vierge</button>
    </div>
  </div>

  <!-- Modale de signature -->
  <div id="signatureModal" class="modal">
    <div class="modal-content">
      <h3>Signer ici</h3>
      <canvas id="modalCanvas" width="500" height="200"></canvas>
      <button onclick="clearModalCanvas()">Effacer</button>
      <button onclick="validateSignature()">Valider</button>
      <button onclick="closeSignatureModal()">Annuler</button>
    </div>
  </div>

  <!-- Librairies PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const modal = document.getElementById("signatureModal");
    const modalCanvas = document.getElementById("modalCanvas");
    const modalCtx = modalCanvas.getContext("2d");
    let drawing = false;

    modalCanvas.addEventListener("mousedown", () => drawing = true);
    modalCanvas.addEventListener("mouseup", () => drawing = false);
    modalCanvas.addEventListener("mousemove", draw);
    modalCanvas.addEventListener("touchstart", () => drawing = true);
    modalCanvas.addEventListener("touchend", () => drawing = false);
    modalCanvas.addEventListener("touchmove", drawTouch);

    function draw(e) {
      if (!drawing) return;
      const rect = modalCanvas.getBoundingClientRect();
      modalCtx.lineWidth = 2;
      modalCtx.lineCap = "round";
      modalCtx.strokeStyle = "#000";
      modalCtx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
      modalCtx.stroke();
      modalCtx.beginPath();
      modalCtx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
    }

    function drawTouch(e) {
      if (!drawing) return;
      const touch = e.touches[0];
      const rect = modalCanvas.getBoundingClientRect();
      modalCtx.lineWidth = 2;
      modalCtx.lineCap = "round";
      modalCtx.strokeStyle = "#000";
      modalCtx.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
      modalCtx.stroke();
      modalCtx.beginPath();
      modalCtx.moveTo(touch.clientX - rect.left, touch.clientY - rect.top);
    }

    function clearModalCanvas() {
      modalCtx.clearRect(0, 0, modalCanvas.width, modalCanvas.height);
    }

    function openSignatureModal() {
      modal.style.display = "flex";
    }

    function closeSignatureModal() {
      modal.style.display = "none";
    }

    function validateSignature() {
      const mainCanvas = document.getElementById("signatureCanvas");
      const mainCtx = mainCanvas.getContext("2d");
      const img = new Image();
      img.onload = () => {
        mainCtx.clearRect(0, 0, mainCanvas.width, mainCanvas.height);
        mainCtx.drawImage(img, 0, 0);
      };
      img.src = modalCanvas.toDataURL();
      closeSignatureModal();
    }

    function exporterPDF() {
      alert("Export PDF simul√© ici.");
    }

    function sauvegarderDonnees() {
      alert("Sauvegarde simul√©e.");
    }

    function restaurerDonnees() {
      alert("Restauration simul√©e.");
    }

    function viderDonnees() {
      alert("Formulaire vid√©.");
    }
  </script>
</body>
</html>